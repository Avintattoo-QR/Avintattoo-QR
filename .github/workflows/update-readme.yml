name: Auto Update README with Avintattoo QR

on:
  push:
    branches:
      - main
    paths:
      - 'index.html'
      - 'Avintattoo-QR.png'
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Extract URL and Update README
        run: |
          # 1. ×©×œ×™×¤×ª ×™×¢×“ ×”×”×¤× ×™×” ×ž×ª×•×š index.html
          TARGET_URL=$(grep -oP 'const targetUrl = "\K[^"]+' index.html || echo "Unknown")
          # × ×™×§×•×™ ×¤×¨×ž×˜×¨×™ UTM ×œ×ª×¦×•×’×” ×™×¤×”
          DISPLAY_URL=$(echo $TARGET_URL | cut -d'?' -f1)
          
          # 2. ×”×’×“×¨×ª ×›×ª×•×‘×•×ª ×”×ž×¢×¨×›×ª
          LIVE_SITE_URL="https://avintattoo-qr.github.io/Avintattoo-QR/"
          REPO_URL="https://github.com/${{ github.repository }}"
          
          # 3. ×–×ž×Ÿ ×¢×“×›×•×Ÿ ××—×¨×•×Ÿ (×–×ž×Ÿ ×™×©×¨××œ ×‘×§×™×¨×•×‘)
          LAST_UPDATE=$(date -u -d "+2 hours" +'%d/%m/%Y %H:%M')

          # 4. ×›×ª×™×‘×ª ×§×•×‘×¥ ×”-README.md ×‘×¢×™×¦×•×‘ ×ž×©×•×¤×¨
          echo "# ðŸ“² ×ž×¢×¨×›×ª QR ×“×™× ×ž×™×ª - Avintattoo" > README.md
          echo "" >> README.md
          echo "×ž×¢×¨×›×ª ×–×• ×ž××¤×©×¨×ª × ×™×”×•×œ ×§×•×“ QR ×¤×™×–×™ ×¢× ×™×¢×“ ×”×¤× ×™×” ×ž×©×ª× ×” ×œ×œ× ×¦×•×¨×š ×‘×”×“×¤×¡×” ×ž×—×“×©." >> README.md
          echo "" >> README.md
          echo "## ðŸ¤³ ×§×•×“ ×”-QR ×”×¤×¢×™×œ" >> README.md
          echo "×¡×¨×§×• ××ª ×”×§×•×“ ×œ×ž×˜×” ×›×“×™ ×œ×”×’×™×¢ ×œ×™×¢×“ ×”×ž×¢×•×“×›×Ÿ:" >> README.md
          echo "" >> README.md
          echo '<p align="center">' >> README.md
          echo '  <img src="./Avintattoo-QR.png" width="300" alt="Avintattoo QR Code">' >> README.md
          echo '</p>' >> README.md
          echo "" >> README.md
          echo "---" >> README.md
          echo "" >> README.md
          echo "## ðŸ“Š ×ž×™×“×¢ ×˜×›× ×™ ×•×¡×˜×˜×•×¡" >> README.md
          echo "| × ×ª×•×Ÿ | ×¤×¨×˜×™× |" >> README.md
          echo "| :--- | :--- |" >> README.md
          echo "| **×¡×˜×˜×•×¡ ×”×¤× ×™×”** | ×¤×¢×™×œ âœ… |" >> README.md
          echo "| **×™×¢×“ ×”×¤× ×™×” × ×•×›×—×™** | [$DISPLAY_URL]($TARGET_URL) |" >> README.md
          echo "| **×›×ª×•×‘×ª ×”××ª×¨ (Live)** | [$LIVE_SITE_URL]($LIVE_SITE_URL) |" >> README.md
          echo "| **×¢×“×›×•×Ÿ ××—×¨×•×Ÿ** | $LAST_UPDATE |" >> README.md
          echo "| **×ž××’×¨ ×§×•×“ (Repository)** | [×§×™×©×•×¨ ×œ×ž××’×¨]($REPO_URL) |" >> README.md
          echo "" >> README.md
          echo "---" >> README.md
          echo "## ðŸ›  ××™×š ×–×” ×¢×•×‘×“?" >> README.md
          echo "1. ×§×•×“ ×”-QR ×”×¤×™×–×™ ×ž×¤× ×” ×œ×›×ª×•×‘×ª ×©×œ **GitHub Pages**." >> README.md
          echo "2. ×“×£ ×”× ×—×™×ª×” ×ž×¨×™×¥ ×¡×§×¨×™×¤×˜ ×”×¤× ×™×” ××•×˜×•×ž×˜×™ ×œ×™×¢×“ ×©×ž×•×’×“×¨ ×‘×§×•×“." >> README.md
          echo "3. ×›×“×™ ×œ×©× ×•×ª ××ª ×™×¢×“ ×”-QR, ×¤×©×•×˜ ×¢×•×¨×›×™× ××ª ×”-URL ×‘×ª×•×š ×§×•×‘×¥ \`index.html\`." >> README.md
          echo "4. ×”×‘×•×˜ ×ž×¢×“×›×Ÿ ××ª ×”-README ×”×–×” ×‘××•×¤×Ÿ ××•×˜×•×ž×˜×™ ×œ××—×¨ ×›×œ ×©×™× ×•×™." >> README.md

      - name: Commit and Push changes
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add README.md
          git commit -m "Bot: Updated README with links, stats and timestamp" || echo "No changes to commit"
          git push
