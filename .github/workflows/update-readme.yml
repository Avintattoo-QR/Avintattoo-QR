name: Auto Update README with Avintattoo QR

on:
  push:
    branches:
      - main
    paths:
      - 'index.html'
      - 'Avintattoo-QR.png'
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Extract URL and Update README
        run: |
          # 1. ×©×œ×™×¤×ª ×™×¢×“ ×”×”×¤× ×™×” ×ž×ª×•×š index.html
          TARGET_URL=$(grep -oP 'const targetUrl = "\K[^"]+' index.html || echo "Unknown")
          # × ×™×§×•×™ ×¤×¨×ž×˜×¨×™ UTM ×œ×ª×¦×•×’×” ×‘×˜×‘×œ×”
          DISPLAY_URL=$(echo $TARGET_URL | cut -d'?' -f1)
          
          # 2. ×”×’×“×¨×ª ×›×ª×•×‘×ª ×”××ª×¨ ×”×—×™
          LIVE_SITE_URL="https://avintattoo-qr.github.io/Avintattoo-QR/"
          
          # 3. ×–×ž×Ÿ ×¢×“×›×•×Ÿ ××—×¨×•×Ÿ (×–×ž×Ÿ ×™×©×¨××œ ×‘×§×™×¨×•×‘)
          LAST_UPDATE=$(date -u -d "+2 hours" +'%d/%m/%Y %H:%M')

          # 4. ×›×ª×™×‘×ª ×§×•×‘×¥ ×”-README.md
          echo "# ðŸ“² ×ž×¢×¨×›×ª QR ×“×™× ×ž×™×ª - Avintattoo" > README.md
          echo "" >> README.md
          echo "× ×™×”×•×œ ×”×¤× ×™×” ×“×™× ×ž×™×ª ×¢×‘×•×¨ ×§×•×“ QR ×¤×™×–×™." >> README.md
          echo "" >> README.md
          echo "## ðŸ¤³ ×§×•×“ ×”-QR ×œ×¡×¨×™×§×”" >> README.md
          echo '<p align="center">' >> README.md
          echo '  <img src="./Avintattoo-QR.png" width="300" alt="Avintattoo QR Code">' >> README.md
          echo '</p>' >> README.md
          echo "" >> README.md
          echo "---" >> README.md
          echo "" >> README.md
          echo "## ðŸ“Š ×¡×˜×˜×•×¡ ×•×ž×™×“×¢" >> README.md
          echo "| × ×ª×•×Ÿ | ×¤×¨×˜×™× |" >> README.md
          echo "| :--- | :--- |" >> README.md
          echo "| **×¡×˜×˜×•×¡** | ×¤×¢×™×œ âœ… |" >> README.md
          echo "| **×™×¢×“ ×”×¤× ×™×”** | [$DISPLAY_URL]($TARGET_URL) |" >> README.md
          echo "| **×›×ª×•×‘×ª ×”-QR (Live)** | [$LIVE_SITE_URL]($LIVE_SITE_URL) |" >> README.md
          echo "| **×¢×“×›×•×Ÿ ××—×¨×•×Ÿ** | $LAST_UPDATE |" >> README.md
          echo "" >> README.md
          echo "---" >> README.md

      - name: Commit and Push changes
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add README.md
          git commit -m "Bot: Updated README status and timestamp" || echo "No changes to commit"
          git push
